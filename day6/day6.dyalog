p←↑⊃⎕NGET'input'1
 f←{
     ⍺←0
     m←⍵
     x y←⊃⍸m='^'
     m[x-1;y]=⍺:⍬
     z←⊃⌽({⍵/⍨x>⍵}(⍸'#'=m[;y]))
     m[;y]←(⍺@(z↓⍳x))m[;y]
     z=0:m
     m[z+1;y]←'^'
     (4|(⍺+1))∇⍉⌽m
 }
 +/+/'*'=(f p)  ⍝ Part 1

 +/({+/+/(⍵-1)=x}¨⍳ 4)